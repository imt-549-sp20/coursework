<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Javascript AJAX | IMT 549 - Intro to Web Development</title>
    <meta name="description" content="Intro to Web Development">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="shortcut icon" href="/coursework/favicon.ico">
    
    <link rel="preload" href="/coursework/assets/css/0.styles.54215caa.css" as="style"><link rel="preload" href="/coursework/assets/js/app.6b55f3c6.js" as="script"><link rel="preload" href="/coursework/assets/js/2.102d0eb8.js" as="script"><link rel="preload" href="/coursework/assets/js/16.b8fcb0a6.js" as="script"><link rel="prefetch" href="/coursework/assets/js/10.ab7faa79.js"><link rel="prefetch" href="/coursework/assets/js/11.83595c18.js"><link rel="prefetch" href="/coursework/assets/js/12.2b485452.js"><link rel="prefetch" href="/coursework/assets/js/13.d310006d.js"><link rel="prefetch" href="/coursework/assets/js/14.9129a17e.js"><link rel="prefetch" href="/coursework/assets/js/15.fa0077b4.js"><link rel="prefetch" href="/coursework/assets/js/17.d708c1cd.js"><link rel="prefetch" href="/coursework/assets/js/18.19f0d3fd.js"><link rel="prefetch" href="/coursework/assets/js/19.7eb550a6.js"><link rel="prefetch" href="/coursework/assets/js/20.ca3f0ee5.js"><link rel="prefetch" href="/coursework/assets/js/21.17ada998.js"><link rel="prefetch" href="/coursework/assets/js/22.a223e686.js"><link rel="prefetch" href="/coursework/assets/js/23.29202546.js"><link rel="prefetch" href="/coursework/assets/js/3.e30ffadd.js"><link rel="prefetch" href="/coursework/assets/js/4.b82b0f3f.js"><link rel="prefetch" href="/coursework/assets/js/5.760478e7.js"><link rel="prefetch" href="/coursework/assets/js/6.cf676257.js"><link rel="prefetch" href="/coursework/assets/js/7.fc42b263.js"><link rel="prefetch" href="/coursework/assets/js/8.6b1946c6.js"><link rel="prefetch" href="/coursework/assets/js/9.0c9a5fa4.js">
    <link rel="stylesheet" href="/coursework/assets/css/0.styles.54215caa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coursework/" class="home-link router-link-active"><!----> <span class="site-name">IMT 549 - Intro to Web Development</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/coursework/" class="sidebar-link">Welcome to IMT 549 - Intro to Web Development</a></li><li><a href="/coursework/getting-setup.html" class="sidebar-link">Getting setup tutorial</a></li><li><a href="/coursework/managing-files.html" class="sidebar-link">Managing files tutorial</a></li><li><a href="/coursework/github-pull-requests.html" class="sidebar-link">GitHub Branching and Merging</a></li><li><a href="/coursework/encoding-html.html" class="sidebar-link">Encoding in HTML</a></li><li><a href="/coursework/github-pages.html" class="sidebar-link">Publishing to GitHub pages</a></li><li><a href="/coursework/emmet-autocomplete.html" class="sidebar-link">Emmet autocompletion</a></li><li><a href="/coursework/browsersync.html" class="sidebar-link">Auto refreshing with Browsersync</a></li><li><a href="/coursework/adding-css.html" class="sidebar-link">Adding CSS style</a></li><li><a href="/coursework/using-chrome-inspector.html" class="sidebar-link">Using the Chrome inspector</a></li><li><a href="/coursework/responsive.html" class="sidebar-link">Responding to devices</a></li><li><a href="/coursework/css-frameworks.html" class="sidebar-link">CSS Frameworks</a></li><li><a href="/coursework/javascript-intro.html" class="sidebar-link">Introduction to Javascript</a></li><li><a href="/coursework/javascript-dom.html" class="sidebar-link">DOM manipulation</a></li><li><a href="/coursework/javascript-iteration.html" class="sidebar-link">Javascript iteration</a></li><li><a href="/coursework/javascript-sorting.html" class="sidebar-link">Javascript sorting and filtering</a></li><li><a href="/coursework/javascript-ajax.html" class="active sidebar-link">Javascript AJAX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coursework/javascript-ajax.html#ajax" class="sidebar-link">AJAX</a></li><li class="sidebar-sub-header"><a href="/coursework/javascript-ajax.html#json" class="sidebar-link">JSON</a></li><li class="sidebar-sub-header"><a href="/coursework/javascript-ajax.html#the-fetch-function" class="sidebar-link">The fetch() Function</a></li><li class="sidebar-sub-header"><a href="/coursework/javascript-ajax.html#asynchronous-requests-and-promises" class="sidebar-link">Asynchronous requests and promises</a></li><li class="sidebar-sub-header"><a href="/coursework/javascript-ajax.html#trying-it-out" class="sidebar-link">Trying it out</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript-ajax"><a href="#javascript-ajax" class="header-anchor">#</a> Javascript AJAX</h1> <iframe width="725" height="408" src="https://www.youtube.com/embed/T6yFfXmnRl0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe> <p>Now that you know how to create page content from data stored in a local variable, the next logical step is to learn how to fetch those data dynamically from a web service. This allows you to get up-to-date data each time your page loads, and even automatically refresh those data while the user remains on the page. JavaScript allow us to make requests to other web services, and process the results, without navigating or refreshing the page.</p> <h2 id="ajax"><a href="#ajax" class="header-anchor">#</a> AJAX</h2> <p>Back in the early days of the web (early 1990s), all data fetching and template merging happened on the server. Web browsers received fully-merged static HTML pages, and if you wanted fresher data, you had to refresh the page. If you wanted to send data back to the server, you filled out a form and let the browser submit the form to the server, where the data were processed and a new response page was generated. At that time, browsers were more like the &quot;dumb terminals&quot; of the mini-computer era, and all the real work happened on the server-side.</p> <p>JavaScript was added to web browsers starting in 1995, which made it possible to execute code on the client-side. But that code couldn't do very much until 1997, when both Netscape Navigator and Internet Explorer added the Document Object Model (DOM). Now one could conceivably build page content from data, but the data still had to be included in the initial set of files downloaded for the page. Refreshing the data still required a full page refresh.</p> <p>In the late 1990s, Microsoft started building a web-based version of their email and calendaring application Outlook, and they wanted a way to check for new mail and send new messages without triggering a full page refresh. Initially they toyed around with using a hidden <code>&lt;iframe&gt;</code> element, but the technique was clumsy and full of potential security issues. So they eventually proposed a new programming interface that would let JavaScript make an asynchronous HTTP request back to the web server from which the page came, and process the results once they returned. In response, the Internet Explorer team added a new global object named <code>XMLHttpRequest</code>, which could do just that.</p> <p>The name of the object began with <code>XML</code> because at that time XML was all the rage, and the Outlook Web Access team figured they would encode data transmitted from the server to the client in XML. The <code>XMLHttpRequest</code> object would let them make an HTTP request to their server, and would automatically parse the returned data as XML so that they could work with it in their JavaScript. Since HTML was a variant of XML, they could use the same DOM interface when working with the returned data.</p> <p>When I first saw this in action, my jaw hit the floor. Up until that point, the web was a pretty mediocre application platform, barely better than what we had in the 1980s with mini-computers and dumb terminals. Now with the <code>XMLHttpRequest</code> object, we could build rich, interactive graphical client-side applications, like we had been building on desktop GUI operating systems like Windows, but with no installation step required. A user could simply navigate to a web site, and start using the downloaded application.</p> <p>This technique quickly became popular, and was given a name: <strong>AJAX</strong>, which was an acronym for <strong>A</strong>synchronous <strong>J</strong>avaScript <strong>A</strong>nd <strong>X</strong>ML. The &quot;Asynchronous&quot; part came from the fact that HTTP requests needed to be done asynchronously so that they didn't block the rest of your JavaScript. Since JavaScript is single-threaded, they couldn't just pause all of your script while waiting for the server to respond (which could take a while on a slow network). If the user clicked something in the meantime and your click event listener function didn't run, the user would think that the application was broken. So the HTTP request is done asynchronously, and your code provides a callback function, which is invoked once the server responds.</p> <p>By the mid-2000s, all major web sites were adding AJAX-based functionality, and new web applications were architected entirely around AJAX. These new application architectures were more reminiscent of the client-server era, where servers exposed Application Programming Interfaces (APIs) that returned and accepted raw data, encoded in some sort of easily interchanged format. Transforming that data into something a user could see was the job of the client application, and one could build many types of client applications against the same server. Since only data flowed back and forth over the network and not a presentation language like HTML, one could build both a web client and a native desktop client that spoke to the same server. As soon as smart mobile devices came along, they became just one more type of client application, interacting with the same server APIs.</p> <h2 id="json"><a href="#json" class="header-anchor">#</a> JSON</h2> <p>In a client-server architecture, the client and server applications are commonly implemented in different programming languages, so the data that is sent between them must be encoded into a format that is easy to generate and parse by all languages. In the late-1990s and early-2000s, the encoding format of choice was XML, but JavaScript developers became frustrated with how difficult it was to work with XML data in the web browser. In contrast, JavaScript arrays and objects were very easy to work with, and there was already a simple text-based format for declaring those that any language could consume, so why not use that instead?</p> <p>The result was the <strong>JSON</strong> encoding scheme, which stands for <strong>J</strong>ava <strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation. The format is much simpler and more compact than XML, and it can be parsed directly into native JavaScript arrays and objects. It also supports a wider set of value literalsâ€”all attributes and element content in XML must be encoded as a string so extra meta-data is required to indicate the actual data type (number, boolean, etc). JSON defines a syntax for literal strings, numbers, booleans, and nulls.</p> <p>JSON was also very familiar to JavaScript developers, as it looks almost identical to the way one declares arrays and objects in code. For example, here is a JSON-encoded object:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;lname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Doe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;active&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The only real difference between JSON and a JavaScript object declaration is that the property names <strong>must</strong> be wrapped in quotes, even if they are legal JavaScript identifiers. In a JavaScript object declaration, we can omit the quotes around property names that are legal identifiers, but it also doesn't hurt to include the quotes.</p> <p>Note that the value for the <code>&quot;id&quot;</code> property is a literal number, so it's included without quotes. This tells any program parsing this data that the value is numeric and should be parsed as such. Similarly, the value for <code>&quot;active&quot;</code> is a boolean literal <code>true</code>, which will be parsed into a boolean value (as opposed to a string or a number). And the value for <code>&quot;description&quot;</code> is a literal null, which will be parsed into a null data type.</p> <p>JavaScript has built-in support for generating and parsing JSON. To parse the JSON above, you can use <code>JSON.parse()</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">;</span> <span class="token comment">//JSON-encoded string from above</span>

<span class="token comment">//parse the JSON string into a JavaScript object</span>
<span class="token comment">//`obj` will be a native JavaScript object with</span>
<span class="token comment">//the same properties as you see in the JSON</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And to generate JSON, you can use <code>JSON.stringify()</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//create a JavaScript object</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">43</span><span class="token punctuation">,</span> fname<span class="token operator">:</span> <span class="token string">&quot;Jane&quot;</span><span class="token punctuation">,</span> lname<span class="token operator">:</span> <span class="token string">&quot;Lee&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//convert to JSON-encoded string</span>
<span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>JSON quickly displaced XML as the data-encoding format of choice for web applications, and <a href="http://www.json.org/" target="_blank" rel="noopener noreferrer">parsers were developed for all major programming languages<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. We still refer to the general technique as &quot;AJAX&quot;, but it's rare to find a web application these days that uses XML as the primary data-encoding format.</p> <h2 id="the-fetch-function"><a href="#the-fetch-function" class="header-anchor">#</a> The <code>fetch()</code> Function</h2> <p>The <code>XMLHttpRequest</code> object allows JavaScript developers to request JSON or XML-encoded data from the server, but the programming interface it exposed is quite complex to use. For example, here is the code necessary to make a simple request for some data:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//create a new XMLHttpRequest object</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//configure it to do an asynchronous GET request for some URL</span>
request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/my/data/url&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//add a listener for the &quot;load&quot; event, which</span>
<span class="token comment">//will happen when the data returns</span>
request<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Success!</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// We reached our target server, but it returned an error</span>
    <span class="token comment">//handle error...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//add a listener for the &quot;error&quot; event, which</span>
<span class="token comment">//will happen if there was a network error</span>
request<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//handle error...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//finally, send the request to the server</span>
request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>That's quite a lot of code for a rather simple operation. Understandably, developers quickly built libraries to simplify the common case. The most used was the <a href="http://api.jquery.com/jQuery.getJSON/" target="_blank" rel="noopener noreferrer"><code>.getJSON()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> method that was added to the popular <a href="https://jquery.com/" target="_blank" rel="noopener noreferrer">jQuery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> library. It replaced the code above with this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//assuming that the jQuery library has been added to the page...</span>
<span class="token comment">//second parameter is a function to be called when the request</span>
<span class="token comment">//is complete and the data has been returned</span>
$<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;/my/data/url&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//`data` is the already-parsed JSON data returned from the server</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This was a much easier programming interface, but it required the entire jQuery library to be included in the page, which added another <code>87KB</code> of script to your application. And since the <a href="http://youmightnotneedjquery.com/" target="_blank" rel="noopener noreferrer">need for the jQuery library has largely gone away<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, developers started asking for something like the jQuery <code>.getJSON()</code> method to be built-in to the browser as a native API.</p> <p>The result was the <code>fetch()</code> API, which is now <a href="https://caniuse.com/#feat=fetch" target="_blank" rel="noopener noreferrer">supported in all major browsers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> except IE 11 and Safari 10. For those browsers, we just have to add a <a href="https://github.com/github/fetch" target="_blank" rel="noopener noreferrer">small polyfill library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that implements the <code>fetch()</code> function using the existing <code>XMLHttpRequest</code> object.</p> <p>A <strong>polyfill</strong> library is one that adds a feature that is not yet supported natively by the browser by implementing that feature in JavaScript using existing functionality. The fetch polyfill implements the new <code>fetch()</code> function using the existing <code>XMLHttpRequest</code> interface. If the library detects the native implementation, it simply exits and does nothing.</p> <p>To add the <code>fetch()</code> polyfill library <a href="https://cdnjs.com/libraries/fetch" target="_blank" rel="noopener noreferrer">from its CDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, simply include this <code>script</code> element in your HTML page, <em>before</em> any script where you use the <code>fetch()</code> function:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> polyfill<span class="token punctuation">,</span> version <span class="token number">2.0</span><span class="token number">.1</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token keyword">for</span> the most recent version<span class="token punctuation">,</span> see https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>cdnjs<span class="token punctuation">.</span>com<span class="token operator">/</span>libraries<span class="token operator">/</span>fetch <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.1/fetch.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> your script <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;js/app.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="asynchronous-requests-and-promises"><a href="#asynchronous-requests-and-promises" class="header-anchor">#</a> Asynchronous requests and promises</h2> <p>Because HTTP requests are done asynchronously, the <code>fetch()</code> function returns an object known as a <strong>Promise</strong>. A Promise represents an asynchronous operation that will eventually complete successfully or fail. A Promise allows developers to add functions that should be called when either of those conditions occurs. These are just like event listeners, except there are only two events: success (aka resolve), and fail (aka reject). So the Promise object provides two different methods, one for registering a success listener (<code>.then()</code>), and one for registering a failure listener (<code>.catch()</code>).</p> <p>To fetch a URL, call the <code>fetch()</code> function passing the URL you want to fetch. It returns a Promise, which you can use to register a callback function that will be invoked when the server responds:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/my/data/url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//add a function to be called when the request completes successfully</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//parse response as JSON</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Declaring that intermediate variable <code>promise</code> is unnecessary in JavaScript, so we typically combine those two statements above into one:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/my/data/url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//parse response as JSON</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And to make the code a bit more readable, we typically insert a line break after the call to <code>fetch()</code> and before the call to the Promise's <code>.then()</code> method:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/my/data/url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//this is called after the server responds to our request</span>
  <span class="token comment">//parse response as JSON</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The function we pass to the Promise's <code>.then()</code> method will be called once the server begins to respond. The <code>response</code> object passed to this function as the first parameter allows us to do several things, but most commonly, you will want to parse the response body as JSON-encoded data. To do that, simply <code>return response.json()</code>.</p> <p>The <code>response.json()</code> method is another asynchronous operation, so it actually returns a new Promise as well. But the neat thing about promises is that if you return a new Promise from a <code>.then()</code> callback function, the outer Promise will take on the state of the new returned Promise. That allows us to add another <code>.then()</code> callback function, which will be called once the JSON parsing has completed:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/my/data/url&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//parse response as JSON</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//this is called after the JSON parsing is complete</span>
    <span class="token comment">//`data` will be the parsed data (Object or Array)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The return value of the first <code>.then()</code> method is the same Promise object, so syntactically we can keep chaining <code>.then()</code> methods, one after the other.</p> <p>All of this code so far assumes that the network request completes successfully, but when computer networks are involved, you should always assume that the request could fail. The client's WiFi connection might be down, or their connection to their ISP could be down, or the server could be down.</p> <p>To respond to a network failure, we can use the Promise's <code>.catch()</code> method to register a function that will be called if the request fails. Your function will be handed an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank" rel="noopener noreferrer">Error object<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as the first parameter, which will contain details about the error.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/my/data/url&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//write the full error object to the console</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//show the error message to the user</span>
    <span class="token comment">//you could instead set the `.textContent` of some</span>
    <span class="token comment">//DOM element you use to show errors</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The really nice thing about Promises is that the function we pass to <code>.catch()</code> will be called if any error occurs either during the fetch, or in the JSON parsing. If any of the functions passed to <code>.then()</code> cause an error to occur, execution will automatically jump to your <code>.catch()</code> function, skipping any intermediary <code>.then()</code> functions. This allows you to centralize your error handling in one place, and avoid calling code that depends upon the previous code executing without errors.</p> <h2 id="trying-it-out"><a href="#trying-it-out" class="header-anchor">#</a> Trying it out</h2> <p>There are <a href="https://www.programmableweb.com/" target="_blank" rel="noopener noreferrer">many, many sources of live data on the web<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, but the one we will use for a quick demo, and for your challenge, is the <a href="https://data.seattle.gov/" target="_blank" rel="noopener noreferrer">data.seattle.gov<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> site. This site hosts public data for the city of Seattle, and one interesting dataset is the <a href="https://data.seattle.gov/Transportation/Fremont-Bridge-Hourly-Bicycle-Counts-by-Month-Octo/65db-xm6k" target="_blank" rel="noopener noreferrer">hourly bicycle traffic counts across the Fremont bridge<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>All of the datasets on the site can be returned in JSON format, and you can supply extra parameters on the URL to filter and sort the data. For example, this URL will return the most-recent 24 hours of data. Click on the URL to see the JSON data in your browser.</p> <p><a href="https://data.seattle.gov/resource/4xy5-26gy.json?$order=date%20desc&amp;$limit=24" target="_blank" rel="noopener noreferrer">https://data.seattle.gov/resource/4xy5-26gy.json?$order=date%20desc&amp;$limit=24<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>You can see that it returns an array of objects, one for each hour. The objects have three properties each: <code>date</code> (date and time of observation), <code>fremont_bridge_nb</code> (number of bikes traveling on the east sidewalk), and <code>fremont_bridge_sb</code> (number of bikes traveling on the west sidewalk).</p> <p>Once we fetch this data and parse it as JSON, we can render it to an HTML table, similar to how to rendered the <code>people</code> array in the previous tutorial, or the <code>MOVIES</code> array in the previous challenge.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//last 24-hours of data from Fremont Bridge bike traffic</span>
<span class="token keyword">var</span> dataURL <span class="token operator">=</span>
  <span class="token string">&quot;https://data.seattle.gov/resource/4xy5-26gy.json?$order=date%20desc&amp;$limit=24&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">parseAsJSON</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">renderRecord</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//create a &lt;tr&gt; and &lt;td&gt; elements for each property</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">renderTable</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//`data` is an array of objects</span>
  <span class="token comment">//loop over the array calling renderRecord()</span>
  <span class="token comment">//for each record, and appending the returned</span>
  <span class="token comment">//&lt;tr&gt; to the &lt;tbody&gt;</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token comment">//fetch the data</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>dataURL<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>parseAsJSON<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>renderTable<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleError<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Because the parsing as JSON and handling of errors is something that will be similar for all <code>fetch()</code> requests, it makes sense to define these functions once and simply pass a reference to them to the <code>.then()</code> and <code>.catch()</code> methods. I also defined a function for the table rendering, similar to what we had done before. When passing just the function names (i.e., references), it makes the Promise chain read almost like English: &quot;fetch this URL, then parse it as JSON, then render it to a table, and handle any errors that happen along the way.&quot;</p> <p>To see this in action, visit my <a href="https://codepen.io/nickdenardis/pen/YLYgLx" target="_blank" rel="noopener noreferrer">fetch example on CodePen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/coursework/javascript-sorting.html" class="prev">
        Javascript sorting and filtering
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/coursework/assets/js/app.6b55f3c6.js" defer></script><script src="/coursework/assets/js/2.102d0eb8.js" defer></script><script src="/coursework/assets/js/16.b8fcb0a6.js" defer></script>
  </body>
</html>
